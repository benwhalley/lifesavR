---
title: 'Working with groups'
author: 'Ben Whalley, Paul Sharpe, Sonja Heintz'
# date: "April 2021"
bibliography: [references.bib]
csl: apa.csl
#biblio-style: apa6
link-citations: yes
output:
  webex::html_clean
---

```{r, include=F, echo=F}
source('_first_chunk.R')
```


```{html, child="bs-tab-fix.html"}
```


```{css, child="video.css"}
```



# Overview

As researchers, we often collect data from two or more groups.

Group allocations are *categorical* variables. They are stored in a special way by R which makes it easier to display
them on graphs. In this workshop we learn to how to use categorical variables in boxplots, to add colour to scatterplots, and
to make tables of descriptive statistics.


<!-- - Types of data (and impact on how R presents it) -->
<!-- - Different purposes of plots/graphics -->
<!-- - Purpose and design of data graphics -->


### Techniques covered

- [Making boxplots](#boxplots)
- [Adding colour to a plot](#colour)
- [Using different types of data and visual scales](#datatypes)
- [Using `group_by()` to make a summary table and compare groups](#groupby)


# Making boxplots {#boxplots}

```{r, echo=F}
video_data <- list(identifier = "boxplot-introduction", ytidentifier = "yt-embed")
# makermds(video_data)
```

```{r child = '_content/_video_tabs.rmd'}
```

:::{.exercise}
**Exercise 1**

1. Use the `iris` dataset to create a boxplot with `Species` on the x-axis and `Sepal.Width` on the y-axis (sepals are the leaves that encase an iris flower)

Your boxplot should look like this:

```{r, echo=FALSE}
iris %>%
  ggplot(aes(Species, Sepal.Length)) +
  geom_boxplot()
```
:::

# Adding colour to a plot {#colour}

```{r, echo=F}
video_data <- list(identifier = "scatterplot-color", ytidentifier = "yt-embed")
# makermds(video_data)
```

```{r child = '_content/_video_tabs.rmd'}
```

:::{.exercise}
**Exercise 2**

1. Use the `development` data from the `psydata` package (run `library(psydata)` first if you haven't already)
1. Create a scatterplot with `life_expectancy` on the x-axis (along the bottom) and `gdp_per_capita`
   on the y-axis
1. Add colour to this scatterplot: make each `continent` a different colour
1. Run the chunk of code

Your plot should look like this:

```{r ex10, echo=FALSE}
library(gapminder)
gapminder %>%
  ggplot(aes(lifeExp, gdpPercap, colour = continent)) +
  geom_point()
```
:::

# Using different types of data and visual scales{#datatypes}

```{r, echo=F}
video_data <- list(identifier = "types-scales", ytidentifier = "yt-embed")
# makermds(video_data)
```

```{r child = '_content/_video_tabs.rmd'}
```

:::{.exercise}
**Exercise 3**

Work with a friend: Describe the 4 ways in which quantitative researchers might use the word 'variable'?

(If you need to look these up from the video or text above then try testing yourself again after completing other exercises).

:::

:::{.exercise}
**Exercise 4**

Use `glimpse()` to check the data types of the `mpg` and the `diamonds` datasets.

- The data type of the 4th variable in the `mpg` data is `r mcq(c("double", "factor", "character", answer=typeof(mpg[[4]])))`
- The data type 5th variable in the `diamonds` data is `r mcq(c("date","character", "factor", answer=typeof(diamonds[[5]])))`

:::


:::{.exercise}
**Exercise 5**

Use the `fuel` dataset to make a boxplot showing miles per gallon on the y-axis, and number of gears (`gear`) on the x-axis. Your plot should look like this:

```{r, echo=FALSE}
fuel %>%
  ggplot(aes(factor(gear), mpg)) +
  geom_boxplot()
```

Remember that you will need to *change* the type of the `gear` variable for this to work.

:::

# Using `group_by()` to make a summary table and compare groups{#groupby}

```{r, echo=F}
video_data <- list(identifier = "group-by", ytidentifier = "yt-embed")
# makermds(video_data)
```

```{r child = '_content/_video_tabs.rmd'}
```



:::{.exercise}

**Exercise 6**

Replace the `?` in the code below to to calculate the `median` weight lost for men and women undergoing FIT and MI in the
`funimagery` dataset:

```{r, eval=F}
? %>%
  group_by(?, ?) %>%
  summarise( ?(weight_lost_end_trt) )
```

These are the correct numbers to check your work against:

```{r, echo=F, include=T}
funimagery %>%
  group_by(Gender=gender, Intervention=intervention) %>%
  summarise(`Median weight loss` =  sprintf("%.1f", median(weight_lost_end_trt) )) %>%
  mutate(Gender=factor(Gender, levels=c("m", "f"), labels=c("Male", "Female"))) %>%
  pander()
```


:::


:::{.exercise}

**Exercise 7**

Use `group_by()` and `summarise()` with the built-in `iris` dataset to calculate the mean `Sepal.Length` for each `Species` of flower.

These are the correct numbers to check your work against:

```{r, echo=F, include=T}
iris %>%
  group_by(Species) %>%
  summarise(`Mean sepal length` =  sprintf("%.1f", mean(Sepal.Length) )) %>%
  pander()
```
:::


:::{.exercise}

**Exercise 8**

The built-in dataset `chickwts` contains weights of chicks (in grams) fed on different diets. Use `group_by()` and `summarise()` to calculate the mean and standard deviation chick weights for each type of feed.

```{r, echo=FALSE, eval=FALSE}
chickwts %>%
  group_by(feed) %>%
  summarise(mean(weight), sd(weight))
```

The mean weight of chicks fed on linseed was `r fitb('218.75', tol=1)`g.

The standard deviation of chicks fed on sunflower was `r fitb('48.84', tol=1)`g.

:::

# Check your knowledge

Write an answer to each of these questions in the `Check your knowledge` section of your workbook. The answers will be revealed in Session 4.

1. Which functions are needed to make a boxplot?
1. What is the difference between a `dbl` and a `fct` or `ord`?
1. Which datatypes are used for continuous variables?
1. Give an example of why the difference between `dbl` and `fct` matters when making a plot (include code examples for this if you can)
1. How can you convert a variable from a `dbl` to a `fct`?
1. How could you calculate the mean for one level of a factor?
1. How would you calculate the mean for all levels of a factor (e.g. for continent in the `development` dataset)?
1. How would you calculate means and standard deviations for all combinations of levels in two factors? 

# Extension exercises


```{r, child="_content/extension-exercises-premable.rmd"}
```




:::{.exercise}

**Extension exercise 1**

Make a scatterplot of the `diamonds` data. Show `carat` on the x-axis, `price` on the y-axis, and the `clarity` of the diamonds in colour. Try to produce your plot _before_ comparing it against the answer using the button below.

`r hide('show answer')`
```{r, echo=FALSE}
diamonds %>%
  ggplot(aes(carat, price, colour = clarity)) +
  geom_point()
```
`r unhide()`


Interpret your plot: Which category of diamond `clarity` has the steepest rise in price as
size (carat) increases?

:::

:::{.exercise}

**Extension exercise 2**

Make a scatterplot of the `fuel` dataset. Show `mpg` on the y-axis, engine size on the x-axis, and use type of transmission (auto/manual) to colour the points. Try to produce your plot before comparing it against the answer using the button below.

`r hide('show answer')`
```{r, echo=FALSE}
fuel %>%
  ggplot(aes(engine_size, mpg, colour = automatic)) +
  geom_point()
```
`r unhide()`

Interpret your plot: Which type of car (auto or manal) sees the strongest relationship between engine size and fuel economy?
:::

:::{.exercise}

**Extension exercise 3**

Using the `development` dataset, make a boxplot showing life expectancy by continent for years greater than 1999. (Hint: use `filter()`, `ggplot()` and `geom_boxplot()`.)

The plot should look like this:

```{r, echo=FALSE}
development %>%
  filter(year > 1999) %>%
  ggplot(aes(continent, life_expectancy)) +
  geom_boxplot()
```
:::

:::{.exercise}

**Extension exercise 4**

Try to recreate the plot below using the `mtcars` built-in dataset. Remember to use `factor()` for columns which require conversion to `fct`.

```{r, echo=F}
mtcars %>%
  ggplot(aes(wt, mpg, colour=factor(gear))) +
  geom_point()
```
:::

:::{.exercise}

**Extension exercise 5**

Try to recreate the table below using the `painmusic` dataset from `psydata`.

```{r, echo=FALSE}
painmusic %>%
  group_by(liked = factor(liked), familiar = factor(familiar)) %>%
  summarise(mean_pain_no_music = mean(pain.with.music), sd_pain_no_music = sd(pain.with.music))
```

:::

# References
