RMarkdown documents are a good way to use R.


RMarkdown is a file format which combines R code (chunks) with regular text. This means
RMarkdown can combine data analysis and graphs with explanatory text, which makes it easier
for you to work, keep notes, and communicate your work to others.


:::{.direction}

- Show an example of an Rmarkdown document by creating a new one from the template.
- Run some of the code chunks, empahsising we will go through this in detail below.
- Show how the graphs etc. appear inline

:::

In a finished RMarkdown document, the R code gets run, and and the results are interspersed with text to make
either an html file or a PDF. This allows us to make high quality reports, research papers, dissertations or books.


:::{.direction}

- Press the knit button and show the output.

:::


Because it's such a powerful tool, this module provides an early introduction to RMarkdown.
We don't use all it's features just yet, though.
For the moment, we'll only *be using Rmd document as an interactive interface for running code and looking at the results R produces*.


### Using RMarkdown

A neat feature of `.Rmd` files is that, when you open them in RStudio, they
make it easy to organise and run R code, and see the outputs.

Provided you have already run the bootstrap script, click on the `lifesavr` folder in the **Files** pane of RStudio,

:::{.direction}

- Click on files folder

:::

You'll notice that some files have the extension `.rmd`. These are R Markdown files.

:::{.direction}

- Highlight file extension by selecting or pointing with mouse

:::

The file extension `.rmd` (or .`Rmd`) is important, because this is how R Studio knows that the files contain a mixture of R code and regular text.

If you don't save files with the right extension, R has trouble knowing what to do with it.


### Code chunks

RMarkdown makes a distinction between R code and regular, narrative text.

This tells RStudio how to treat each part of your document — whether to display
it as text, or format it as code (and give us warnings when there are errors and so on).

This is done by putting the code inside some special
characters, called backticks, creating a  ***code chunk***.

A chunk is opened using the symbols `` ```{r} ``, and closed using
the symbols `` ``` ``. This is what a chunk looks like in RStudio:

![A code chunk in the RMarkdown editor](images/r-code-chunk.png)

---------


_NOTE:_ The symbols which start and end a chunk are _backticks_, not single quotes. The difference is quite subtle.


Backticks are on your keyboard here if you're on Windows:

![On windows](images/backtick-windows-uk.png)

Or here if you're on a Mac:

![On a Mac](images/backtick-mac-uk.png)






### Running R code inside chunks

<!-- TODO: re-record VIDEO of running code in a chunk -->

In the picture of a chunk above you might have noticed that we had both some code (`2+2`) and the
result from that code was shown beneat the chunk (`4`!). To show the result of our code, we first need to ***run*** it.



There are three ways to run R code within a chunk:

- Run one or more related lines, called a ***statement***
- Select and run just part of a statement
- Run a whole chunk at once (can include multiple statements)


#### Running a statement

The most common case is when we have given R an instruction (written a *statement*) and we want to run
just that new code.

A statement is cometimes one line of code, but it can include multiple lines that are related — we'll see more of that
later.

For now, you can see we have a code chunk here:


```{r}
# some arithmetic in R

2 + 2 + 8 + 16

```

:::{.direction}

1. Show cursor interacting with this code chunk
1. Place cursor anywhere on the line
1. Run statement using Ctrl + Enter

:::

You can see that we put the cursor in the middle of this line of numbers that we wanted to add up.
Then I pressed <span class="keyshape">Ctrl</span> + <span class="keyshape">↵</span>  (this would be the `Cmd` key on a Mac).

This runs or *executes* the whole line, and the result is shown *below* the code chunk.


#### Code chunks with multiple statements

We might want to add some extra calculations to our chunk.

```{r}
# some arithmetic in R

2 + 2 + 8 + 16

42 * 42

```

Now we have 2 statements: `2 + 2 + 8 + 16` and `42 * 42` (the star means multiply).
We can run either of the statements in the same way: by putting the cursor anywhere on the line
and pressing `Ctrl/Cmd + Enter`


:::{.direction}

- Demonstrate doing this in rstudio show that the cursor can be anywhere on the line and also
- That if we execute a second statement the result of the first one disappears
- Also point out that I did separate all the statements with a blank line to make it easier for myself to read (but R doesn t care about this and can work out whether the lines are related by itself)

:::


#### Running PART of a statement

Normally, R looks at our code and tries to run a whole statement at a time, because usually
that is what we want. It knows when a statement is broken over multiple lines in the
Rmd file and runs them all together.

Another important trick in R is to be able to run just part of a statement, checking each part in turn.

:::{.direction}

Demonstrate selecting 2+2 then 2+2+8 and then the whole linke and running by pressing ctrl enter each time to get the partial result

:::

We're going to see how important this can be in later sessions when we write longer statements that we break up over multiple
lines of code.

Just to give you a flavour for now, this is a statement which:

- takes a dataset about national happiness and GDP (wealth)
- selects only data from 2018
- makes a scatterplot

We can run each part of it in turn

```{r}
happy %>%
  filter(year==2018) %>%
  ggplot(aes(gdp_per_capita, happiness)) +
  geom_point()
```


:::{.direction}

- Demonstrate selecting each part in turn again
- Point out that we can check what data has been sent to the plot and amend if necessary
- Demonstrate making an error where no data are selected and adjusting the code to fix it

:::



#### Running the whole chunk


Sometimes it's more convenient to run a whole chunk of code at once.

If we look at this chunk again, we can run everything in it by

- Placing the cursor somewhere in the chunk
- Pressing `Shift+Ctrl+Enter` (`Shift+Cmd+Enter` on a Mac)

:::{.direction}

Demonstrate this using the chunk above with two lines of arithmetic

:::

You can now see that we have two results listed below the chunk: one for each statement.

![](images/chunk-run-all.png)
